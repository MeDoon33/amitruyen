{% extends "base.html" %} {% block title %}Truyện Của Tôi{% endblock %} {% block
styles %}
<style>
  .stats-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    padding: 20px;
    color: white;
    margin-bottom: 20px;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    transition: transform 0.3s ease;
  }

  .stats-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
  }

  .stats-card .icon {
    font-size: 2.5rem;
    margin-bottom: 10px;
    opacity: 0.9;
  }

  .stats-card .number {
    font-size: 2rem;
    font-weight: bold;
    margin: 10px 0 5px 0;
  }

  .stats-card .label {
    font-size: 0.9rem;
    opacity: 0.9;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .comic-card {
    border-radius: 10px;
    overflow: hidden;
    transition: all 0.3s ease;
    border: 1px solid #e0e0e0;
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .comic-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
  }

  .comic-card-img {
    width: 100%;
    height: 250px;
    object-fit: cover;
    border-bottom: 3px solid #667eea;
  }

  .comic-card-body {
    padding: 15px;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }

  .comic-title {
    font-weight: bold;
    font-size: 1.1rem;
    margin-bottom: 10px;
    color: #333;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .comic-meta {
    font-size: 0.85rem;
    color: #666;
    margin-bottom: 10px;
  }

  .comic-meta i {
    margin-right: 5px;
    color: #667eea;
  }

  .comic-actions {
    margin-top: auto;
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
  }

  .badge-custom {
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
  }

  .badge-comic {
    background-color: #e3f2fd;
    color: #1976d2;
  }

  .badge-novel {
    background-color: #f3e5f5;
    color: #7b1fa2;
  }

  .badge-ongoing {
    background-color: #e8f5e9;
    color: #388e3c;
  }

  .badge-completed {
    background-color: #fff3e0;
    color: #f57c00;
  }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #999;
  }

  .empty-state i {
    font-size: 4rem;
    margin-bottom: 20px;
    opacity: 0.5;
  }

  .page-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    border-radius: 15px;
    margin-bottom: 30px;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
  }
</style>
{% endblock %} {% block content %}
<div class="container-fluid">
  <!-- Page Header -->
  <div class="page-header">
    <h1 class="mb-0">
      <i class="fas fa-book-open me-2"></i>
      {% if viewing_other %} Truyện của {{ target_user.get_display_name() }} {%
      else %} Quản Lý Truyện Của Tôi {% endif %}
    </h1>
    <p class="mb-0 mt-2" style="opacity: 0.9">
      {% if viewing_other %} Xem và quản lý các truyện do {{
      target_user.username }} đăng tải
      <a
        href="{{ url_for('admin.my_comics') }}"
        class="btn btn-sm btn-light ms-3"
      >
        <i class="fas fa-arrow-left me-1"></i>Quay lại truyện của tôi
      </a>
      {% else %} Quản lý và theo dõi các truyện bạn đã đăng tải {% endif %}
    </p>
  </div>

  <!-- Statistics Cards -->
  <div class="row mb-4">
    <div class="col-md-3 col-sm-6 mb-3">
      <div class="stats-card">
        <div class="icon">
          <i class="fas fa-book"></i>
        </div>
        <div class="number">{{ stats.total_comics }}</div>
        <div class="label">Tổng Truyện</div>
      </div>
    </div>

    <div class="col-md-3 col-sm-6 mb-3">
      <div
        class="stats-card"
        style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"
      >
        <div class="icon">
          <i class="fas fa-list-ol"></i>
        </div>
        <div class="number">{{ stats.total_chapters }}</div>
        <div class="label">Tổng Chương</div>
      </div>
    </div>

    <div class="col-md-3 col-sm-6 mb-3">
      <div
        class="stats-card"
        style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"
      >
        <div class="icon">
          <i class="fas fa-eye"></i>
        </div>
        <div class="number">{{ '{:,}'.format(stats.total_views) }}</div>
        <div class="label">Tổng Lượt Xem</div>
      </div>
    </div>

    <div class="col-md-3 col-sm-6 mb-3">
      <div
        class="stats-card"
        style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"
      >
        <div class="icon">
          <i class="fas fa-heart"></i>
        </div>
        <div class="number">{{ stats.total_follows }}</div>
        <div class="label">Tổng Theo Dõi</div>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="mb-4 d-flex justify-content-between align-items-center">
    <h4 class="mb-0">
      <i class="fas fa-list me-2"></i>
      Danh Sách Truyện ({{ stats.total_comics }})
    </h4>
    <a href="{{ url_for('admin.upload_comic') }}" class="btn btn-primary">
      <i class="fas fa-plus me-2"></i>
      Đăng Truyện Mới
    </a>
  </div>

  <!-- Comics Grid -->
  {% if comics %}
  <div class="row">
    {% for comic in comics %}
    <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
      <div class="comic-card">
        <a
          href="{{ url_for('comic.view_comic', comic_id=comic.id) }}"
          target="_blank"
        >
          <img
            src="{{ comic.cover_image }}"
            class="comic-card-img"
            alt="{{ comic.title }}"
            onerror="this.src='https://via.placeholder.com/300x400?text=No+Cover'"
          />
        </a>

        <div class="comic-card-body">
          <h5 class="comic-title">
            <a
              href="{{ url_for('comic.view_comic', comic_id=comic.id) }}"
              class="text-decoration-none text-dark"
              target="_blank"
            >
              {{ comic.title }}
            </a>
          </h5>

          <div class="mb-2">
            <span
              class="badge-custom {% if comic.content_type == 'novel' %}badge-novel{% else %}badge-comic{% endif %}"
            >
              {% if comic.content_type == 'novel' %}
              <i class="fas fa-file-alt"></i> Truyện Chữ {% else %}
              <i class="fas fa-image"></i> Truyện Tranh {% endif %}
            </span>
            <span
              class="badge-custom {% if comic.status == 'completed' %}badge-completed{% else %}badge-ongoing{% endif %}"
            >
              {% if comic.status == 'completed' %}
              <i class="fas fa-check-circle"></i> Hoàn Thành {% elif
              comic.status == 'hiatus' %}
              <i class="fas fa-pause-circle"></i> Tạm Dừng {% else %}
              <i class="fas fa-sync"></i> Đang Ra {% endif %}
            </span>
          </div>

          <div class="comic-meta">
            <div class="mb-1">
              <i class="fas fa-user"></i>
              <strong>Tác giả:</strong> {{ comic.author or 'Không rõ' }}
            </div>
            <div class="mb-1">
              <i class="fas fa-eye"></i>
              <strong>{{ '{:,}'.format(comic.views) }}</strong> lượt xem
            </div>
            <div class="mb-1">
              <i class="fas fa-heart"></i>
              <strong>{{ comic.follow_count }}</strong> theo dõi
            </div>
            <div class="mb-1">
              <i class="fas fa-star"></i>
              <strong>{{ '%.1f' | format(comic.rating) }}</strong>
              <span class="text-muted"
                >({{ comic.rating_count }} đánh giá)</span
              >
            </div>
            <div class="mb-1">
              <i class="fas fa-list"></i>
              <strong>{{ comic.chapters|length }}</strong> chương
            </div>
            <div class="mb-1">
              <i class="fas fa-calendar"></i>
              {{ comic.created_at.strftime('%d/%m/%Y') }}
            </div>
          </div>

          <div class="comic-actions">
            <a
              href="{{ url_for('comic.view_comic', comic_id=comic.id) }}"
              class="btn btn-sm btn-outline-primary flex-grow-1"
              target="_blank"
            >
              <i class="fas fa-eye"></i> Xem
            </a>
            <a
              href="{{ url_for('admin.add_chapter', comic_id=comic.id) }}"
              class="btn btn-sm btn-outline-success flex-grow-1"
            >
              <i class="fas fa-plus"></i> Thêm Chương
            </a>
            <a
              href="{{ url_for('admin.edit_comic', comic_id=comic.id) }}"
              class="btn btn-sm btn-outline-warning"
            >
              <i class="fas fa-edit"></i>
            </a>
            <form
              action="{{ url_for('admin.delete_comic', comic_id=comic.id) }}"
              method="POST"
              class="d-inline"
              onsubmit="return confirm('Bạn có chắc chắn muốn xóa truyện này? Tất cả chapters sẽ bị xóa!');"
            >
              <button type="submit" class="btn btn-sm btn-outline-danger">
                <i class="fas fa-trash"></i>
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Pagination -->
  {% if pagination.pages > 1 %}
  <nav aria-label="Page navigation" class="mt-4">
    <ul class="pagination justify-content-center">
      {% if pagination.has_prev %}
      <li class="page-item">
        <a
          class="page-link"
          href="{{ url_for('admin.my_comics', page=pagination.prev_num) }}"
        >
          <i class="fas fa-chevron-left"></i> Trước
        </a>
      </li>
      {% endif %} {% for page_num in pagination.iter_pages(left_edge=1,
      right_edge=1, left_current=2, right_current=2) %} {% if page_num %} {% if
      page_num == pagination.page %}
      <li class="page-item active">
        <span class="page-link">{{ page_num }}</span>
      </li>
      {% else %}
      <li class="page-item">
        <a
          class="page-link"
          href="{{ url_for('admin.my_comics', page=page_num) }}"
          >{{ page_num }}</a
        >
      </li>
      {% endif %} {% else %}
      <li class="page-item disabled">
        <span class="page-link">...</span>
      </li>
      {% endif %} {% endfor %} {% if pagination.has_next %}
      <li class="page-item">
        <a
          class="page-link"
          href="{{ url_for('admin.my_comics', page=pagination.next_num) }}"
        >
          Sau <i class="fas fa-chevron-right"></i>
        </a>
      </li>
      {% endif %}
    </ul>
  </nav>
  {% endif %} {% else %}
  <!-- Empty State -->
  <div class="empty-state">
    <i class="fas fa-book-open"></i>
    <h3 class="mt-3">Chưa Có Truyện Nào</h3>
    <p class="text-muted mb-4">
      Bạn chưa đăng truyện nào. Hãy bắt đầu đăng truyện đầu tiên!
    </p>
    <a
      href="{{ url_for('admin.upload_comic') }}"
      class="btn btn-primary btn-lg"
    >
      <i class="fas fa-plus me-2"></i>
      Đăng Truyện Đầu Tiên
    </a>
  </div>
  {% endif %}
</div>
{% endblock %}
