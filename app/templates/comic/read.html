{% extends "base.html" %} {% block title %}{{ comic.title }} - Chapter {{
chapter.chapter_number }}{% endblock %} {% block extra_css %}
<style>
  .reader-container {
    max-width: 800px;
    margin: 0 auto;
  }
  .reader-container img {
    width: 100%;
    height: auto;
    margin-bottom: 10px;
  }
  .chapter-navigation {
    position: sticky;
    top: 0;
    background: rgba(0, 0, 0, 0.8);
    padding: 10px 0;
    z-index: 1000;
  }
  .btn-prev-next {
    min-width: 120px;
  }
</style>
{% endblock %} {% block content %}
<div class="chapter-navigation text-center mb-4">
  <div class="btn-group">
    {% if first_chapter and last_chapter %}
    <a
      href="{{ url_for('comic.read_chapter', comic_id=comic.id, chapter_number=first_chapter.chapter_number) }}"
      class="btn btn-secondary btn-sm {% if chapter.id == first_chapter.id %}disabled{% endif %}"
      title="First Chapter"
    >
      « First
    </a>
    {% endif %} {% if prev_chapter %}
    <a
      href="{{ url_for('comic.read_chapter', comic_id=comic.id, chapter_number=prev_chapter.chapter_number) }}"
      class="btn btn-primary btn-prev-next"
    >
      ← Chapter {{ prev_chapter.chapter_number }}
    </a>
    {% endif %}

    <a
      href="{{ url_for('comic.view_comic', comic_id=comic.id) }}"
      class="btn btn-secondary"
    >
      Chapter List
    </a>

    {% if next_chapter %}
    <a
      href="{{ url_for('comic.read_chapter', comic_id=comic.id, chapter_number=next_chapter.chapter_number) }}"
      class="btn btn-primary btn-prev-next"
    >
      Chapter {{ next_chapter.chapter_number }} →
    </a>
    {% endif %} {% if first_chapter and last_chapter %}
    <a
      href="{{ url_for('comic.read_chapter', comic_id=comic.id, chapter_number=last_chapter.chapter_number) }}"
      class="btn btn-secondary btn-sm {% if chapter.id == last_chapter.id %}disabled{% endif %}"
      title="Last Chapter"
    >
      Last »
    </a>
    {% endif %}
  </div>
</div>

<div class="reader-container">
  <h1 class="text-center mb-4">
    {{ comic.title }} - Chapter {{ chapter.chapter_number }}
  </h1>

  {% for image_url in images %}
  <img src="{{ image_url }}" alt="Page {{ loop.index }}" loading="lazy" />
  {% endfor %}
</div>

<div class="chapter-navigation text-center mt-4">
  <div class="btn-group">
    {% if first_chapter and last_chapter %}
    <a
      href="{{ url_for('comic.read_chapter', comic_id=comic.id, chapter_number=first_chapter.chapter_number) }}"
      class="btn btn-secondary btn-sm {% if chapter.id == first_chapter.id %}disabled{% endif %}"
      title="First Chapter"
    >
      « First
    </a>
    {% endif %} {% if prev_chapter %}
    <a
      href="{{ url_for('comic.read_chapter', comic_id=comic.id, chapter_number=prev_chapter.chapter_number) }}"
      class="btn btn-primary btn-prev-next"
    >
      ← Chapter {{ prev_chapter.chapter_number }}
    </a>
    {% endif %}

    <a
      href="{{ url_for('comic.view_comic', comic_id=comic.id) }}"
      class="btn btn-secondary"
    >
      Chapter List
    </a>

    {% if next_chapter %}
    <a
      href="{{ url_for('comic.read_chapter', comic_id=comic.id, chapter_number=next_chapter.chapter_number) }}"
      class="btn btn-primary btn-prev-next"
    >
      Chapter {{ next_chapter.chapter_number }} →
    </a>
    {% endif %} {% if current_user.is_authenticated and (
    current_user.is_moderator() or (comic.uploader_id == current_user.id and
    current_user.role == 'uploader') ) %}
    <a
      href="{{ url_for('admin.edit_chapter', chapter_id=chapter.id) }}"
      class="btn btn-warning ms-2"
      >Edit Chapter</a
    >
    {% endif %} {% if first_chapter and last_chapter %}
    <a
      href="{{ url_for('comic.read_chapter', comic_id=comic.id, chapter_number=last_chapter.chapter_number) }}"
      class="btn btn-secondary btn-sm {% if chapter.id == last_chapter.id %}disabled{% endif %}"
      title="Last Chapter"
    >
      Last »
    </a>
    {% endif %}
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  (function () {
    // Precomputed URLs (empty string if none)
    const prevUrl =
      "{{ url_for('comic.read_chapter', comic_id=comic.id, chapter_number=prev_chapter.chapter_number) if prev_chapter else '' }}";
    const nextUrl =
      "{{ url_for('comic.read_chapter', comic_id=comic.id, chapter_number=next_chapter.chapter_number) if next_chapter else '' }}";
    const firstUrl =
      "{{ url_for('comic.read_chapter', comic_id=comic.id, chapter_number=first_chapter.chapter_number) if first_chapter else '' }}";
    const lastUrl =
      "{{ url_for('comic.read_chapter', comic_id=comic.id, chapter_number=last_chapter.chapter_number) if last_chapter else '' }}";

    function go(url) {
      if (!url) return;
      window.location.assign(url);
    }

    document.addEventListener("keydown", function (e) {
      const activeTag = (
        (document.activeElement && document.activeElement.tagName) ||
        ""
      ).toLowerCase();
      if (["input", "textarea", "select"].includes(activeTag)) return; // don't hijack form fields

      const k = e.key; // modern key
      switch (k) {
        case "ArrowLeft":
        case "Left": // legacy IE
          if (prevUrl) {
            e.preventDefault();
            go(prevUrl);
            return;
          }
          break;
        case "ArrowRight":
        case "Right":
          if (nextUrl) {
            e.preventDefault();
            go(nextUrl);
            return;
          }
          break;
        case "Home":
          if (firstUrl) {
            e.preventDefault();
            go(firstUrl);
            return;
          }
          break;
        case "End":
          if (lastUrl) {
            e.preventDefault();
            go(lastUrl);
            return;
          }
          break;
      }

      // Fallback for environments only giving keyCode
      if (e.keyCode === 37 && prevUrl) {
        e.preventDefault();
        go(prevUrl);
      } else if (e.keyCode === 39 && nextUrl) {
        e.preventDefault();
        go(nextUrl);
      }
    });
  })();
</script>
{% endblock %}
