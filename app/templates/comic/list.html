{% extends "base.html" %} {% block title %}Danh Sách Truyện{% endblock %} {%
block content %}
<style>
  .card-img-top {
    max-height: 220px;
    object-fit: cover;
    width: 100%;
  }
  .card-genre-badges {
    display: block;
    max-width: 100%;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .uploader-text {
    display: inline-block;
    max-width: 150px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    vertical-align: middle;
  }
</style>
<div class="row">
  <div class="col-12">
    <h1 class="mb-4">Danh Sách Truyện</h1>

    <div class="filter-section mb-4">
      <form class="row g-3" method="GET">
        <div class="col-md-3">
          <input
            type="text"
            class="form-control"
            name="search"
            placeholder="Tìm tên truyện, tác giả..."
            value="{{ search or '' }}"
          />
        </div>
        <div class="col-md-3">
          <select class="form-select" name="genre">
            <option value="">Tất cả thể loại</option>
            {% for g in genres %}
            <option
              value="{{ g }}"
              {% if genre == g %}selected{% endif %}
            >
              {{ g }}
            </option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-3">
          <select class="form-select" name="status">
            <option value="">Tất cả trạng thái</option>
            {% for s in statuses %}
            <option
              value="{{ s }}"
              {% if status == s %}selected{% endif %}
            >
              {{ s }}
            </option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-2">
          <button type="submit" class="btn btn-primary w-100">Lọc</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4">
  {% for comic in comics.items %}
  <div class="col">
    <div class="card h-100">
      <img
        src="{{ comic.cover_image }}"
        class="card-img-top"
        alt="{{ comic.title }}"
      />
      <div class="card-body">
        <h5 class="card-title">{{ comic.title }}</h5>
        <p class="card-text">
          <small class="text-muted">
            <i class="fas fa-feather-alt me-1"></i>{{ comic.author or 'Đang cập nhật' }}
          </small><br />
          {% if comic.uploader %}
          <small class="text-muted">
            <i class="fas fa-upload me-1"></i>
            <span class="uploader-text" title="{{ comic.uploader.username }}">{{ comic.uploader.username }}</span>
          </small><br />
          {% endif %}
          <span class="badge bg-primary">{{ comic.status }}</span>
          <span class="card-genre-badges">
            <span class="badge bg-secondary">{{ comic.genre }}</span>
          </span>
        </p>
        <p class="card-text text-truncate">{{ comic.description }}</p>
        <a
          href="{{ url_for('comic.view_comic', comic_id=comic.id) }}"
          class="btn btn-primary"
          >Read Now</a
        >
      </div>
      <div class="card-footer">
        <small class="text-muted"
          >Updated: {{ comic.updated_at.strftime('%Y-%m-%d') }}</small
        >
      </div>
    </div>
  </div>
  {% endfor %}
</div>

{% if comics.pages > 1 %}
<nav aria-label="Page navigation" class="mt-4">
  <ul class="pagination justify-content-center">
    {% if comics.has_prev %}
    <li class="page-item">
      <a
        class="page-link"
        href="{{ url_for('comic.get_comics', page=comics.prev_num, genre=genre, status=status, search=search) }}"
        >Previous</a
      >
    </li>
    {% endif %} {% for page_num in comics.iter_pages(left_edge=2,
    left_current=2, right_current=2, right_edge=2) %} {% if page_num %}
    <li class="page-item {% if page_num == comics.page %}active{% endif %}">
      <a
        class="page-link"
        href="{{ url_for('comic.get_comics', page=page_num, genre=genre, status=status, search=search) }}"
        >{{ page_num }}</a
      >
    </li>
    {% else %}
    <li class="page-item disabled"><span class="page-link">...</span></li>
    {% endif %} {% endfor %} {% if comics.has_next %}
    <li class="page-item">
      <a
        class="page-link"
        href="{{ url_for('comic.get_comics', page=comics.next_num, genre=genre, status=status, search=search) }}"
        >Next</a
      >
    </li>
    {% endif %}
  </ul>
</nav>
{% endif %} {% endblock %}
